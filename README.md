# Go-Supervisord

A lightweight, high-performance process management tool implemented in Go, inspired by Python's `supervisord`. It allows users to monitor and control multiple processes in the background, ensuring they are automatically restarted if they crash unexpectedly.

## âœ¨ Core Features

- **Daemonization**: Can run as a background daemon, detached from the terminal.
- **Process Management**: Defines and manages a group of child processes via a simple TOML configuration file.
- **Auto-Restart**: Automatically attempts to restart child processes when they exit due to an unexpected error.
- **Remote Control**: Includes a built-in HTTP/Unix Socket server, allowing remote control via a command-line client.
- **Log Management**: Captures `stdout` and `stderr` of child processes, with support for log rotation and size limits.
- **Dynamic Configuration**: Supports dynamically adding new process configurations at runtime using the `add-proc` command.
- **Cross-Platform**: Designed for compatibility with both Linux and Windows platforms.
- **Script Execution**: Supports executing `glisp` scripts for advanced management tasks.

## ðŸš€ Quick Start

### 1. Build

```bash
go build -o supervisord ./main.go
```

### 2. Configuration File

Create a `supervisord.conf` file in your project directory. Here is a basic configuration example:

```toml
# Supervisord's management port
admin_listen = 9001

# Supervisord's own log file
log = "/var/log/supervisord/supervisord.log"

# If true, supervisord will exit after all managed processes have exited successfully
exit_when_all_done = false

# If true, supervisord will run in the background as a daemon
daemonize = true

# If true, supervisord will clean up log files generated by child processes upon exit
enable_log_finalizer = true

# Define a process to be managed
[[process]]
name = "my-app"
command = "/path/to/your/app"
args = ["--port", "8080"]

# Working directory for the process
cwd = "/path/to/your"

# stdout log for the process
stdout = ["/var/log/supervisord/my-app.stdout.log"]

# stderr log for the process
stderr = ["/var/log/supervisord/my-app.stderr.log"]

# Successful exit codes. If the process exits with one of these codes, it's considered a normal exit and won't be restarted.
exit_codes = [0]

# Seconds to wait before sending a KILL signal when stopping the process
stop_wait_secs = 10

# Signal to send when stopping the process (e.g., TERM, HUP, INT)
stop_signal = "TERM"

# Set environment variables for the process
[process.env]
  GO_ENV = "production"
  API_KEY = "your-secret-key"
```

### 3. Start Supervisord

Use the `start` command to launch the `supervisord` daemon for the first time. It will automatically find and load the `supervisord.conf` file.

```bash
# Start the daemon
./supervisord start

# Alternatively, run in the foreground for debugging
./supervisord start -supvr.daemonize false
```

## ðŸ“– Command-line Usage

`supervisord` provides a rich command-line interface to interact with the daemon.

### `service` - Manage Processes

This is the most common command, used to manage processes defined in the configuration file.

```bash
# Check the status of all processes
./supervisord service status

# Start all processes
./supervisord service start

# Stop all processes
./supervisord service stop

# Restart all processes
./supervisord service restart

# Start/Stop/Restart a single process
./supervisord service start my-app
./supervisord service stop my-app
./supervisord service restart my-app
```

### `reload` - Reload Configuration

After modifying `supervisord.conf`, use the `reload` command to apply the new configuration. `supervisord` will gracefully stop old processes and start new ones.

```bash
./supervisord reload
```

### `shutdown` - Shut Down Supervisord

Stops all running child processes and shuts down the `supervisord` daemon.

```bash
# Graceful shutdown
./supervisord shutdown
```

### `add-proc` - Add a Process Dynamically

Dynamically add a new process while `supervisord` is running.

```bash
# Dynamically add a process named "my-worker" 
./supervisord add-proc my-worker /usr/bin/python worker.py
```

### `exec` - Remote Execution

The `exec` command allows you to execute a script file (e.g., a `glisp` script) on the running daemon. This provides a powerful way to perform advanced or custom management tasks.

```bash
# Execute a script file
./supervisord exec /path/to/your/script.glisp
```

